<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Clever Coasters</title>
        <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
        <link href="/styles.css" rel="stylesheet" />
    </head>
    <body>

        <h1 class="title">Clever Coasters - a Coaster REST API</h1>
        <div id="homepage">
            <h1>Find a coaster!!</h1>
            <div id="coasters"></div>
        </div>

        <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
        <script src="https://unpkg.com/react@15/dist/react.js"></script>
        <script src="https://unpkg.com/react-dom@15/dist/react-dom.min.js"></script>﻿


        <!-- Create React Component -->
    <script type="text/babel">
    var Coasters = React.createClass({
      getInitialState: function(){
        return({
          coasters:[]
        });
      },
      render: function(){
        var coasters = this.state.coasters;
        coasters = coasters.map(function(coaster, index){
          return(
            <li key={index}>
              <span className = {coaster.needsRefill}></span>
              <span className ="tableId"> Table {coaster.tableId}</span>
              <span className ="coasterId"> Coaster # {coaster.coasterId}</span>
              <span className ="needsRefill">{coaster.needsRefill}</span>
            </li>
          );
        });
        return(
          <div id = "coaster-container">
          <form id = "search" onSubmit={this.handleSubmit}>
            <label>Search by a table ID:</label>
            <input type = "text" ref = "tableId" placeholder="tableId" />
            <input type = "submit" value = "Return coaster associated to table"  />
          </form>
          <ul>{coasters}</ul>
          </div>
      );
    },
    handleSubmit: function(e){
      e.preventDefault();
      var tableId = this.refs.tableId.value;

      //fetch('/api/coasters?tableId='+tableId+).then(function(data){
      fetch('/api/coasters/').then(function(data){
        return data.json();
      }).then( json => {
        this.setState({
          coasters: json
        });
        console.log(json);
      });
    }
    });

    ReactDOM.render(<Coasters />, document.getElementById('coasters'));
    </script>﻿
  </body>
</html>
